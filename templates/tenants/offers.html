{% extends 'base.html' %}
{% block title %}Offers - {{ business.name }}{% endblock %}
{% block content %}
<div class="bg-gray-100 min-h-screen">
  {% include 'tenants/_business_banner.html' with active_tab='offers' %}
  <div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">Offers - {{ business.name }}</h1>
      <div class="space-x-2">
        <a href="{% url 'create_offer' slug=business.slug %}" class="bg-blue-800 text-white px-4 py-2 rounded-md hover:bg-blue-700">Create Offer</a>
        <a href="{% url 'generate_ai_offer' slug=business.slug %}" class="bg-green-700 text-white px-4 py-2 rounded-md hover:bg-green-600">AI Generate Offer</a>
      </div>
    </div>

    <form method="get" class="ui-form mb-6" role="search" aria-label="Search offers">
      <div class="flex items-center gap-3">
        <input type="text" name="q" value="{{ q|default:'' }}" class="ui-input flex-1 md:w-96" placeholder="Search offers by title, description, or type (e.g., discount)" />
        <button type="submit" class="bg-blue-800 text-white px-4 py-2 rounded-md hover:bg-blue-700">Search</button>
        {% if q %}
          <a href="{% url 'business_offers' slug=business.slug %}" class="text-gray-600 hover:text-gray-900">Clear</a>
        {% endif %}
      </div>
      <p class="ui-help">Tip: Try keywords like "discount", "redeem", "multiplier", or part of the title.</p>
    </form>

  {% if offers|length %}
  <div class="bg-white shadow rounded-md overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Active</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valid</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for offer in offers %}
        <tr>
          <td class="px-6 py-4">{{ offer.title }}</td>
          <td class="px-6 py-4 capitalize">{{ offer.type }}</td>
          <td class="px-6 py-4">{{ offer.is_active|yesno:"Yes,No" }}</td>
          <td class="px-6 py-4">
            {% if offer.valid_from %}{{ offer.valid_from|date:"Y-m-d" }}{% endif %}
            {% if offer.valid_until %} â€“ {{ offer.valid_until|date:"Y-m-d" }}{% endif %}
          </td>
          <td class="px-6 py-4 text-right space-x-2">
            <a href="{% url 'update_offer' slug=business.slug pk=offer.id %}" class="text-blue-700 hover:underline">Edit</a>
            <a href="{% url 'delete_offer' slug=business.slug pk=offer.id %}" class="text-red-600 hover:underline">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
  <nav class="mt-6 flex items-center justify-between" aria-label="Pagination">
    <div>
      <p class="text-sm text-gray-600">Page {{ page_obj.number }} of {{ paginator.num_pages }}</p>
    </div>
    <div class="inline-flex items-center gap-1">
      {% if page_obj.has_previous %}
        <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}" class="px-3 py-2 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">Previous</a>
      {% else %}
        <span class="px-3 py-2 rounded-md border border-gray-200 bg-gray-100 text-gray-400">Previous</span>
      {% endif %}
      {% for num in paginator.page_range %}
        {% if num == page_obj.number %}
          <span class="px-3 py-2 rounded-md bg-blue-600 text-white">{{ num }}</span>
        {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
          <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}" class="px-3 py-2 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">{{ num }}</a>
        {% endif %}
      {% endfor %}
      {% if page_obj.has_next %}
        <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}" class="px-3 py-2 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">Next</a>
      {% else %}
        <span class="px-3 py-2 rounded-md border border-gray-200 bg-gray-100 text-gray-400">Next</span>
      {% endif %}
    </div>
  </nav>
  {% endif %}
  {% else %}
    <p class="text-gray-600">No offers found{% if q %} for "{{ q }}"{% endif %}.{% if q %} <a href="{% url 'business_offers' slug=business.slug %}" class="underline">Clear search</a>.{% endif %}</p>
  {% endif %}
  </div>
</div>
{% endblock %}

{% block footer %}{% endblock %}
